<div *ngIf="isLoading">
    <span>Loading...</span>
</div>

<div
    class="h-screen bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-gray-900 dark:to-gray-800 text-gray-800 dark:text-gray-200">
    <mat-sidenav-container class="h-full">
        <!-- Sidebar avec design amélioré -->
        <mat-sidenav #sidenav mode="side" opened
            class="w-72 bg-white dark:bg-gray-800/95 shadow-xl border-0 flex flex-col">
            <!-- Logo header redesigné -->
            <div class="p-6 flex items-center justify-center border-b border-gray-100 dark:border-gray-700">
                <div class="flex items-center gap-3">
                    <img src="assets/logo.png" alt="Logo" class="h-12 w-auto">
                    <h1
                        class="text-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                        Dashboard
                    </h1>
                </div>
            </div>

            <!-- Contenu défilant avec design amélioré -->
            <div
                class="overflow-y-auto flex-1 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent">
                <div class="px-5 py-6">
                    <!-- User card redesigné -->
                    <div
                        class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700 rounded-2xl p-4 mb-8 shadow-sm">
                        <div class="flex items-center gap-4">
                            <div
                                class="h-12 w-12 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow">
                                <span class="font-bold text-lg">{{user$?.username?.charAt(0) | uppercase}}</span>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800 dark:text-gray-100">{{user$?.username |
                                    titlecase}}</h3>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                    <p class="text-xs font-medium text-blue-600 dark:text-blue-400">{{user$?.roles}}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation redesignée -->
                    <div class="mb-4">
                        <h4
                            class="text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 font-semibold mb-3 px-3">
                            Menu principal</h4>
                        <nav class="space-y-1.5">
                            <a *ngFor="let nav of navigation" [routerLink]="nav.path"
                                routerLinkActive="bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-md"
                                class="flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-gray-700/60 transition-all duration-200 group">
                                <mat-icon
                                    class="mr-3 text-gray-500 dark:text-gray-400 group-[.active]:text-white">{{nav.icon}}</mat-icon>
                                <span class="text-sm font-medium">{{nav.title}}</span>
                            </a>
                        </nav>
                    </div>

                    <!-- Utilisateurs avec design amélioré -->
                    <div class="mb-4">
                        <h4
                            class="text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 font-semibold mb-3 px-3">
                            Gestion utilisateurs</h4>
                        <mat-expansion-panel class="bg-transparent shadow-none mat-elevation-z0 border-0">
                            <mat-expansion-panel-header
                                class="px-4 py-3 rounded-xl hover:bg-blue-50 dark:hover:bg-gray-700/60">
                                <div class="flex items-center">
                                    <mat-icon class="mr-3 text-gray-500 dark:text-gray-400">people</mat-icon>
                                    <span
                                        class="text-sm font-medium text-gray-700 dark:text-gray-300">Utilisateurs</span>
                                </div>
                            </mat-expansion-panel-header>
                            <nav class="space-y-1.5 pl-8 mt-2">
                                <a *ngFor="let subNav of userSubNavigation" [routerLink]="subNav.path"
                                    routerLinkActive="bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-md"
                                    class="flex items-center px-4 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-blue-50 dark:hover:bg-gray-700/60 transition-all duration-200 group">
                                    <mat-icon
                                        class="mr-3 text-gray-400 dark:text-gray-500 text-sm group-[.active]:text-white">{{subNav.icon}}</mat-icon>
                                    <span class="text-xs font-medium">{{subNav.title}}</span>
                                </a>
                            </nav>
                        </mat-expansion-panel>
                    </div>
                </div>
            </div>

            <!-- Footer redesigné -->
            <div class="p-5 border-t border-gray-100 dark:border-gray-700">
                <button mat-button
                    class="w-full py-2.5 flex items-center justify-center gap-2 text-gray-500 dark:text-gray-400 text-sm hover:bg-gray-100 dark:hover:bg-gray-700/60 rounded-xl transition-all">
                    <mat-icon class="text-sm">help_outline</mat-icon>
                    <span>Centre d'aide</span>
                </button>
            </div>
        </mat-sidenav>

        <!-- Main Content avec design amélioré -->
        <mat-sidenav-content class="bg-transparent">
            <!-- Toolbar redesignée -->
            <div class="sticky top-0 z-10">
                <mat-toolbar
                    class="bg-white/80 dark:bg-gray-800/90 backdrop-blur-md h-16 px-5 shadow-sm border-b border-gray-100 dark:border-gray-700">
                    <div class="flex items-center justify-between w-full">
                        <div class="flex items-center gap-4">
                            <button mat-icon-button (click)="sidenav.toggle()"
                                class="rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-700/60 transition-all">
                                <mat-icon>menu</mat-icon>
                            </button>
                            <div class="flex items-center">
                                <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100">{{ currentPage?.title
                                    || 'Dashboard' }}</h2>
                                <span *ngIf="currentPage?.subtitle"
                                    class="ml-2 px-3 py-1 text-xs rounded-full bg-blue-500/10 text-blue-600 dark:text-blue-300 font-medium">
                                    {{ currentPage?.subtitle }}
                                </span>
                            </div>
                        </div>

                        <!-- Actions redesignées -->
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <input type="text" placeholder="Rechercher..."
                                    class="w-64 h-10 pr-8 pl-4 rounded-xl bg-gray-100 dark:bg-gray-700/60 border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 text-sm transition-all" />
                                <mat-icon
                                    class="absolute right-3 top-2.5 text-gray-400 dark:text-gray-500">search</mat-icon>
                            </div>

                            <button mat-icon-button [matMenuTriggerFor]="notificationsMenu"
                                class="rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-700/60 transition-all relative"
                                [matBadge]="unreadNotifications" [matBadgeHidden]="unreadNotifications === 0"
                                matBadgeColor="accent">
                                <mat-icon>notifications</mat-icon>
                                <span *ngIf="unreadNotifications > 0"
                                    class="absolute top-1 right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center text-white text-xs">
                                    {{unreadNotifications}}
                                </span>
                            </button>

                            <button mat-icon-button (click)="toggleDarkMode()"
                                class="rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-700/60 transition-all">
                                <mat-icon [ngClass]="{'text-amber-500': isDarkMode, 'text-indigo-500': !isDarkMode}">
                                    {{ isDarkMode ? 'light_mode' : 'dark_mode' }}
                                </mat-icon>
                            </button>

                            <button mat-icon-button [matMenuTriggerFor]="userMenu"
                                class="ml-2 rounded-full overflow-hidden h-10 w-10 bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow">
                                <img *ngIf="user$.avatar| async" [src]="(user$.avatar| async)" alt="Avatar"
                                    class="h-full w-full object-cover">
                                <mat-icon *ngIf="!(user$.avatar | async)">person</mat-icon>
                            </button>
                        </div>
                    </div>
                </mat-toolbar>
            </div>

            <!-- Content avec design amélioré -->
            <div class="p-6">
                <!-- Breadcrumbs - Nouvel élément -->
                <div class="mb-6 flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <a href="#" class="hover:text-blue-600 dark:hover:text-blue-400">Accueil</a>
                    <mat-icon class="mx-2 text-sm">chevron_right</mat-icon>
                    <span class="text-gray-800 dark:text-gray-200">{{ currentPage?.title || 'Dashboard' }}</span>
                </div>



                <!-- Contenu principal avec design amélioré -->
                <div
                    class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700">
                    <router-outlet></router-outlet>
                </div>
            </div>

            <!-- Menus redesignés -->
            <mat-menu #notificationsMenu="matMenu" class="w-80">
                <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between">
                    <h3 class="font-medium text-gray-800 dark:text-gray-100">Notifications</h3>
                    <span
                        class="text-xs px-2.5 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300 rounded-full font-medium">
                        {{ notifications.length }}
                    </span>
                </div>

                <div class="max-h-96 overflow-y-auto">
                    <a *ngFor="let notif of notifications" href="#"
                        class="flex p-4 hover:bg-gray-50 dark:hover:bg-gray-700/60 border-b border-gray-100 dark:border-gray-700 last:border-0">
                        <div
                            class="mr-3 mt-1 h-9 w-9 rounded-full bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center text-blue-500 dark:text-blue-300 flex-shrink-0">
                            <mat-icon class="text-sm">{{notif.icon || 'notifications'}}</mat-icon>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-800 dark:text-gray-100">{{notif.title}}</div>
                            <!-- <p class="text-xs text-gray-600 dark:text-gray-400 mt-1 line-clamp-2">{{notif.message}}</p> -->
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1 flex items-center">
                                <mat-icon class="text-xs mr-1">schedule</mat-icon>
                                {{notif.time}}
                            </div>
                        </div>
                    </a>
                </div>

                <div class="p-3 bg-gray-50 dark:bg-gray-800">
                    <a href="#"
                        class="block text-center text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 p-2 rounded-lg font-medium">
                        Voir toutes les notifications
                    </a>
                </div>
            </mat-menu>

            <!-- Menu utilisateur redesigné -->
            <mat-menu #userMenu="matMenu" class="min-w-[260px]">
                <div class="p-4 border-b border-gray-100 dark:border-gray-700 mb-2">
                    <div class="flex items-center gap-3">
                        <div
                            class="h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white">
                            <span class="font-bold">{{user$?.username?.charAt(0) | uppercase}}</span>
                        </div>
                        <div>
                            <div class="font-medium text-gray-800 dark:text-gray-100">{{user$?.username | titlecase}}
                            </div>
                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1">{{user$?.roles}}</div>
                        </div>
                    </div>
                </div>

                <button mat-menu-item class="h-12 mb-1 rounded-lg mx-2 hover:bg-gray-50 dark:hover:bg-gray-700/60">
                    <mat-icon class="mr-3 text-gray-500">person</mat-icon>
                    <span class="text-sm">Mon profil</span>
                </button>

                <button mat-menu-item class="h-12 mb-1 rounded-lg mx-2 hover:bg-gray-50 dark:hover:bg-gray-700/60">
                    <mat-icon class="mr-3 text-gray-500">settings</mat-icon>
                    <span class="text-sm">Paramètres</span>
                </button>

                <div class="border-t border-gray-100 dark:border-gray-700 my-2"></div>

                <button mat-menu-item
                    class="h-12 rounded-lg mx-2 mb-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20"
                    (click)="logOut()">
                    <mat-icon class="mr-3">exit_to_app</mat-icon>
                    <span class="text-sm font-medium">Déconnexion</span>
                </button>
            </mat-menu>
        </mat-sidenav-content>
    </mat-sidenav-container>
</div>