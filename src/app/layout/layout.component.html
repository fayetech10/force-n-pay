<div *ngIf="isLoading" class="fixed inset-0 z-50 bg-white/90 dark:bg-gray-900/90 flex items-center justify-center">
    <div class="flex flex-col items-center gap-3">
        <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        <span class="text-gray-600 dark:text-gray-300 font-medium">Chargement en cours...</span>
    </div>
</div>

<div
    class="h-screen bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-900 dark:to-gray-800 text-gray-800 dark:text-gray-200 transition-colors duration-300">
    <mat-sidenav-container class="h-full">
        <!-- Sidebar améliorée avec ombres et transitions -->
        <mat-sidenav #sidenav mode="side" opened
            class="w-72 bg-white/95 dark:bg-gray-800/95 backdrop-blur-md shadow-2xl border-r border-gray-100 dark:border-gray-700 flex flex-col transition-all duration-300">
            <!-- Logo avec animation au survol -->
            <div class="p-6 flex items-center justify-center border-b border-gray-100 dark:border-gray-700">
                <div class="flex items-center gap-3 transform hover:scale-105 transition-transform duration-200">
                    <img src="assets/logo.png" alt="Logo" class="h-12 w-auto drop-shadow-md">
                    <h1
                        class="text-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent animate-gradient-x">
                        Dashboard
                    </h1>
                </div>
            </div>

            <!-- Contenu de la sidebar -->
            <div
                class="flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300/50 dark:scrollbar-thumb-gray-600/50 scrollbar-track-transparent">
                <div class="px-5 py-6">
                    <!-- User Card avec effet de profondeur -->
                    <div class="group relative">
                        <div
                            class="absolute -inset-1 bg-gradient-to-r from-blue-400 to-indigo-500 opacity-10 blur transition-all duration-300 group-hover:opacity-20">
                        </div>
                        <div
                            class="relative bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm transition-all duration-300 hover:shadow-md">
                            <div class="flex items-center gap-4">
                                <div
                                    class="h-12 w-12 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow-lg">
                                    <span class="font-bold text-lg">{{user$.username?.charAt(0) | uppercase}}</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 dark:text-gray-100">{{user$.username |
                                        titlecase}}</h3>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                        <p class="text-xs font-medium text-blue-600 dark:text-blue-400">{{user$.roles}}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation avec indicateur actif amélioré -->
                    <div class="my-8">
                        <h4
                            class="text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 font-medium mb-4 px-3">
                            Menu principal
                        </h4>
                        <nav class="space-y-2">
                            <a *ngFor="let nav of navigation" [routerLink]="nav.path" routerLinkActive="active" class="relative flex items-center px-4 py-3 rounded-xl text-gray-700 dark:text-gray-300 hover:bg-blue-50/50 dark:hover:bg-gray-700/60 transition-all duration-200 group
                                       before:absolute before:left-0 before:w-1 before:h-6 before:bg-transparent before:rounded-r before:transition-all before:duration-300
                                       active:before:bg-blue-500">
                                <mat-icon
                                    class="mr-3 text-gray-500 dark:text-gray-400 group-[.active]:text-white transition-colors">
                                    {{nav.icon}}
                                </mat-icon>
                                <span class="text-sm font-medium group-[.active]:font-semibold">{{nav.title}}</span>
                                <div class="ml-auto opacity-0 group-[.active]:opacity-100 transition-opacity">
                                    <mat-icon class="text-sm text-blue-500">arrow_forward</mat-icon>
                                </div>
                            </a>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Footer avec effet de verre -->
            <div
                class="p-5 border-t border-gray-100 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50 backdrop-blur-md">
                <button mat-button class="w-full py-2.5 flex items-center justify-center gap-2 text-gray-500 dark:text-gray-400 text-sm hover:bg-gray-100/50 dark:hover:bg-gray-700/60 rounded-xl transition-all
                           hover:translate-x-1 hover:shadow-sm">
                    <mat-icon class="text-sm transform transition-transform hover:rotate-12">help_outline</mat-icon>
                    <span>Centre d'aide</span>
                </button>
            </div>
        </mat-sidenav>

        <!-- Contenu principal amélioré -->
        <mat-sidenav-content class="bg-transparent">
            <!-- Barre d'outils avec effet de verre -->
            <div class="sticky top-0 z-10">
                <mat-toolbar
                    class="bg-white/80 dark:bg-gray-800/90 backdrop-blur-md h-16 px-6 shadow-sm border-b border-gray-100 dark:border-gray-700 transition-colors">
                    <div class="flex items-center justify-between w-full">
                        <div class="flex items-center gap-4">
                            <button mat-icon-button (click)="sidenav.toggle()" class="rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100/50 dark:hover:bg-gray-700/60 transition-all
                                       transform hover:rotate-12 active:scale-95">
                                <mat-icon class="text-gray-600 dark:text-gray-300">menu</mat-icon>
                            </button>
                            <div class="flex items-center space-x-2">
                                <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100 tracking-tight">
                                    {{ currentPage?.title || 'Dashboard' }}
                                </h2>
                                <span *ngIf="currentPage?.subtitle"
                                    class="text-xs px-2.5 py-1 rounded-full bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 font-medium border border-blue-200/50 dark:border-blue-800/50">
                                    {{ currentPage?.subtitle }}
                                </span>
                            </div>
                        </div>

                        <!-- Actions avec micro-interactions -->
                        <div class="flex items-center space-x-4">
                            <div class="relative transform transition-all duration-300 hover:scale-105">
                                <input type="text" placeholder="Rechercher..." class="w-64 h-10 pr-10 pl-4 rounded-xl bg-gray-100/50 dark:bg-gray-700/60 border border-gray-200/50 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500/30 text-sm
                                           transition-all shadow-sm hover:shadow-md" />
                                <mat-icon
                                    class="absolute right-3 top-2.5 text-gray-400 dark:text-gray-500">search</mat-icon>
                            </div>

                            <button mat-icon-button [matMenuTriggerFor]="notificationsMenu"
                                class="relative rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100/50 dark:hover:bg-gray-700/60 transition-transform active:scale-95">
                                <mat-icon class="text-gray-600 dark:text-gray-300">notifications</mat-icon>
                                <span *ngIf="unreadNotifications > 0" class="absolute top-0 right-0 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-medium shadow-sm
                                           animate-pulse">
                                    {{unreadNotifications}}
                                </span>
                            </button>

                            <button mat-icon-button (click)="toggleDarkMode()" class="rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100/50 dark:hover:bg-gray-700/60 transition-all
                                       transform hover:rotate-180 duration-500">
                                <mat-icon class="transition-colors duration-300"
                                    [ngClass]="{'text-amber-400': isDarkMode, 'text-indigo-500': !isDarkMode}">
                                    {{ isDarkMode ? 'light_mode' : 'dark_mode' }}
                                </mat-icon>
                            </button>

                            <button mat-icon-button [matMenuTriggerFor]="userMenu" class="ml-2 rounded-full overflow-hidden h-10 w-10 bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow-lg
                                       transform hover:scale-105 transition-transform">
                                <img *ngIf="user$.avatar| async" [src]="(user$.avatar| async)" alt="Avatar"
                                    class="h-full w-full object-cover border-2 border-white/20">
                                <mat-icon *ngIf="!(user$.avatar | async)" class="text-white/90">person</mat-icon>
                            </button>
                        </div>
                    </div>
                </mat-toolbar>
            </div>

            <!-- Contenu principal avec animation -->
            <div class="p-6 animate-fade-in-up">
                <!-- Fil d'Ariane amélioré -->
                <div class="mb-6 flex items-center text-sm text-gray-500 dark:text-gray-400 space-x-2">
                    <a href="#"
                        class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors flex items-center">
                        <mat-icon class="mr-1 text-base">home</mat-icon>
                        Accueil
                    </a>
                    <mat-icon class="text-gray-400">chevron_right</mat-icon>
                    <span class="text-gray-800 dark:text-gray-200 font-medium">{{ currentPage?.title || 'Dashboard'
                        }}</span>
                </div>

                <!-- Carte de contenu avec effet de flottement -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700
                          transform transition-all hover:shadow-md hover:-translate-y-1">
                    <router-outlet></router-outlet>
                </div>
            </div>

            <!-- Menus contextuels améliorés -->
            <mat-menu #notificationsMenu="matMenu" class="w-96 py-0 overflow-hidden">
                <!-- ... (contenu similaire mais avec plus de transitions) ... -->
            </mat-menu>

            <mat-menu #userMenu="matMenu"
                class="min-w-[260px] bg-white/95 dark:bg-gray-800/95 backdrop-blur-md shadow-xl border border-gray-100 dark:border-gray-700">
                <div class="p-4 border-b border-gray-100 dark:border-gray-700 mb-2">
                    <div class="flex items-center gap-3">
                        <div
                            class="h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow-md">
                            <span class="font-bold">{{user$?.username?.charAt(0) | uppercase}}</span>
                        </div>
                        <div>
                            <div class="font-medium text-gray-800 dark:text-gray-100">{{user$.username | titlecase}}
                            </div>
                            <div class="text-xs text-blue-600 dark:text-blue-400 mt-1">{{user$.roles}}</div>
                        </div>
                    </div>
                </div>

                <button mat-menu-item
                    class="h-12 mb-1 rounded-lg mx-2 hover:bg-gray-50 dark:hover:bg-gray-700/60 transition-colors">
                    <mat-icon class="mr-3 text-gray-500">person</mat-icon>
                    <span class="text-sm">Mon profil</span>
                </button>

                <button mat-menu-item
                    class="h-12 mb-1 rounded-lg mx-2 hover:bg-gray-50 dark:hover:bg-gray-700/60 transition-colors">
                    <mat-icon class="mr-3 text-gray-500">settings</mat-icon>
                    <span class="text-sm">Paramètres</span>
                </button>

                <div class="border-t border-gray-100 dark:border-gray-700 my-2"></div>

                <button mat-menu-item
                    class="h-12 rounded-lg mx-2 mb-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors"
                    (click)="logOut()">
                    <mat-icon class="mr-3">exit_to_app</mat-icon>
                    <span class="text-sm font-medium">Déconnexion</span>
                </button>
            </mat-menu>
        </mat-sidenav-content>
    </mat-sidenav-container>
</div>