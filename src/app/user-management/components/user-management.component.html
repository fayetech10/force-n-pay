<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10 bg-gray-100 min-h-screen">
    <!-- En-tête avec actions -->
    <div class="mb-8 flex flex-col sm:flex-row justify-between items-center">
        <div>
            <h1 class="text-3xl font-extrabold text-gray-900">Utilisateurs</h1>
            <p class="mt-2 text-sm text-gray-600">{{ totalUsers }} utilisateurs enregistrés</p>
        </div>
        <button mat-raised-button color="primary" class="h-12 px-4 flex items-center gap-2" (click)="addUser()">
            <mat-icon>person_add</mat-icon>
            Nouvel utilisateur
        </button>
    </div>

    <!-- Statistiques résumé -->
    <div class="mb-8 grid grid-cols-1 md:grid-cols-4 gap-6">
        <!-- Carte Total Users -->
        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500 mb-1">Utilisateurs totaux</p>
                    <p class="text-3xl font-bold text-gray-900">{{ totalUsers }}</p>
                </div>
                <div class="bg-blue-100 p-3 rounded-full">
                    <mat-icon class="text-blue-600">people_alt</mat-icon>
                </div>
            </div>
        </div>
        <!-- Carte Active Users -->
        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500 mb-1">Utilisateurs actifs</p>
                    <p class="text-3xl font-bold text-green-600">{{ activeUsersCount }}</p>
                </div>
                <div class="bg-green-100 p-3 rounded-full">
                    <mat-icon class="text-green-600">check_circle</mat-icon>
                </div>
            </div>
        </div>
        <!-- Carte Nouveaux (7j) -->
        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500 mb-1">Nouveaux (7j)</p>
                    <p class="text-3xl font-bold text-purple-600">{{ newUsersCount }}</p>
                </div>
                <div class="bg-purple-100 p-3 rounded-full">
                    <mat-icon class="text-purple-600">trending_up</mat-icon>
                </div>
            </div>
        </div>
        <!-- Carte Taux moyen -->
        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow duration-300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm text-gray-500 mb-1">Taux moyen</p>
                    <p class="text-3xl font-bold text-orange-600">{{ averageRate | number:'1.1-1' }}€/h</p>
                </div>
                <div class="bg-orange-100 p-3 rounded-full">
                    <mat-icon class="text-orange-600">euro_symbol</mat-icon>
                </div>
            </div>
        </div>
    </div>

    <!-- Tableau responsive -->
    <div class="bg-white rounded-lg shadow overflow-x-auto">
        <table mat-table [dataSource]="dataSource" class="min-w-full divide-y divide-gray-200">
            <!-- Colonne Statut -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"></th>
                <td mat-cell *matCellDef="let user" class="px-6 py-4 whitespace-nowrap">
                    <mat-icon [ngClass]="{'text-green-500': user.actif, 'text-red-500': !user.actif}"
                        matTooltip="{{ user.actif ? 'Actif' : 'Inactif' }}">
                        {{ user.actif ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                </td>
            </ng-container>

            <!-- Colonne Nom -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur
                </th>
                <td mat-cell *matCellDef="let user" class="px-6 py-4 whitespace-nowrap">
                    <div class="text-base font-semibold text-gray-900">{{ user.prenom | titlecase }} {{ user.nom |
                        titlecase}}
                    </div>
                    <div class="text-sm text-gray-500">{{ user.email}}</div>
                </td>
            </ng-container>

            <!-- Colonne Rôle -->
            <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rôle</th>
                <td mat-cell *matCellDef="let user" class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
                        {{ user.roles }}
                    </span>
                </td>
            </ng-container>

            <!-- Colonne Qualifications -->
            <ng-container matColumnDef="qualifications">
                <th mat-header-cell *matHeaderCellDef
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Qualifications</th>
                <td mat-cell *matCellDef="let user" class="px-6 py-4 whitespace-nowrap">
                    <div class="flex flex-wrap gap-2">
                        <span *ngFor="let qual of user.qualifications" class="px-2 py-1 bg-gray-100 rounded-md text-xs">
                            {{ qual }}
                        </span>
                    </div>
                </td>
            </ng-container>

            <!-- Colonne Taux -->
            <ng-container matColumnDef="rate">
                <th mat-header-cell *matHeaderCellDef
                    class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Taux horaire
                </th>
                <td mat-cell *matCellDef="let user" class="px-6 py-4 whitespace-nowrap text-right">
                    <span class="text-base font-semibold text-green-700">
                        {{ user.hourlyRate | number:'1.1-1' }}€
                    </span>
                </td>
            </ng-container>

            <!-- Colonne Actions -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef
                    class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                <td mat-cell *matCellDef="let user" class="px-6 py-4 whitespace-nowrap text-right">
                    <button mat-icon-button color="accent" (click)="viewDetails(user)" matTooltip="Voir détails">
                        <mat-icon>visibility</mat-icon>
                    </button>
                    <button mat-icon-button color="primary" (click)="editUser(user)" matTooltip="Modifier">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteUser(user)" matTooltip="Supprimer">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button mat-icon-button [color]="user.actif ? 'warn' : 'primary'" (click)="toggleUserStatus(user)"
                        matTooltip="Changer le statut">
                        <mat-icon>{{ user.actif ? 'toggle_off' : 'toggle_on' }}</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50"></tr>

            <!-- État vide -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell py-8 text-center" colspan="6">
                    <div class="flex flex-col items-center justify-center p-8">
                        <mat-icon class="text-gray-400 text-4xl mb-4">manage_search</mat-icon>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Aucun résultat</h3>
                        <p class="text-gray-600 max-w-md mx-auto">
                            Aucun utilisateur ne correspond à vos critères de recherche.
                            Essayez d'ajuster les filtres ou de créer un nouvel utilisateur.
                        </p>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <!-- Pagination -->
    <mat-paginator [length]="totalUsers" [pageSize]="pageSize" [pageSizeOptions]="[10, 25, 50]"
        (page)="onPageChange($event)" class="mt-6 bg-white rounded-lg shadow border border-gray-200">
    </mat-paginator>
</div>